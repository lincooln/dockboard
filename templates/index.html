<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docker Dashboard</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: {{ ui_settings.background }};
            --card: {{ ui_settings.card_background }};
            --text: {{ ui_settings.text_color }};
            --accent: {{ ui_settings.accent_color }};
            --border: {{ ui_settings.border_color }};
            --radius: {{ ui_settings.border_radius }}px;
            --font: {{ ui_settings.font_size_base }}px;
            --font-sm: {{ ui_settings.font_size_small }}px;
            --font-lg: {{ ui_settings.font_size_large }}px;
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- –°–¢–ê–¢–£–° –ë–ê–† -->
        <div class="status-bar">
            <div class="status-row">
                <div class="status-items">
                    <!-- –•–æ—Å—Ç–Ω–µ–π–º -->
                    <div class="status-item">
                        <img src="{{ url_for('static', filename='ip-icon.svg') }}" alt="IP" class="status-icon-img">
                        <span class="status-value">{{ stats.hostname }}</span>
                        {% if stats.local_ips %}
                        <span class="font-sm text-muted" title="IP –∞–¥—Ä–µ—Å–∞: {{ stats.local_ips|join(', ') }}">
                            ({{ stats.local_ips[0] }}
                            {% if stats.local_ips|length > 1 %}
                            +{{ stats.local_ips|length - 1 }}
                            {% endif %})
                        </span>
                        {% endif %}
                    </div>

                    <!-- CPU -->
                    <div class="status-item">
                        <img src="{{ url_for('static', filename='cpu-icon.svg') }}" alt="CPU" class="status-icon-img">
                        <span class="status-value" id="cpu-value">{{ stats.cpu }}</span>
                    </div>

                    <!-- –ü–∞–º—è—Ç—å -->
                    <div class="status-item">
                        <img src="{{ url_for('static', filename='ram-icon.svg') }}" alt="RAM" class="status-icon-img">
                        <span class="status-value" id="memory-value">{{ stats.memory.split('(')[0] if stats.memory and '(' in stats.memory else stats.memory }}</span>
                        <span class="font-sm text-muted">
                            ({{ stats.memory.split('(')[1] if stats.memory and '(' in stats.memory else '' }}
                        </span>
                    </div>

                    <!-- Docker -->
                    <div class="status-item">
                        <img src="{{ url_for('static', filename='docker-icon.svg') }}" alt="Docker" class="status-icon-img">
                        <span class="status-value" id="docker-total">{{ stats.containers.total }}</span>
                        <div class="status-dots">
                            <span class="status-dot">
                                <span class="dot dot-running"></span>
                                <span class="font-sm" id="docker-running">{{ stats.containers.running }}</span>
                            </span>
                            <span class="status-dot">
                                <span class="dot dot-stopped"></span>
                                <span class="font-sm" id="docker-stopped">{{ stats.containers.stopped }}</span>
                            </span>
                        </div>
                    </div>
                </div>

                <!-- –î–µ–π—Å—Ç–≤–∏—è -->
                <div class="status-actions">
                    <a href="/favorites" class="btn-icon" title="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ">‚≠ê</a>
                    <a href="/details" class="btn-icon" title="–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è">üñ•Ô∏è</a>
                    <a href="/appearance" class="btn-icon" title="–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ">üé®</a>
                    <a href="/settings" class="btn-icon" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</a>
                </div>
            </div>
        </div>

        <!-- –î–ò–°–ö–ò -->
        {% if stats.has_disks %}
        <div class="grid grid-auto mb">
            {% for disk in stats.disks %}
            {% if not disk.mountpoint.startswith('/boot/efi') %}
            <div class="disk-tile">
                <div class="disk-header">
                    <div class="disk-name">
                        <span>{{ disk.icon }}</span>
                        <span title="{{ disk.mountpoint }}">
                            {{ disk.short_path }}
                        </span>
                    </div>
                    <div class="disk-percent {{ disk.css_class }}">
                        {{ "%.1f"|format(disk.percent) }}%
                    </div>
                </div>

                <div class="disk-info">
                    <span class="disk-type">{{ disk.type }}</span>
                    <span class="disk-size">
                        {{ "%.1f"|format(disk.used_gb) }}G/{{ "%.1f"|format(disk.total_gb) }}G
                    </span>
                </div>

                <div class="disk-bar">
                    <div class="disk-bar-fill {{ disk.css_class }}"
                         style="width: {{ disk.percent }}%"></div>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
        {% endif %}

        <!-- –°–ï–†–í–ò–°–´ -->
        <div class="grid grid-auto">
            {% if services %}
                {% for service in services %}
                <div class="tile">
                    <!-- –°—Ç–∞—Ç—É—Å —Ç–æ—á–∫–∞ -->
                    <div class="status-dot-container">
                        <div class="dot {% if service.status == 'running' %}dot-running{% else %}dot-stopped{% endif %}"></div>
                    </div>
    
                    <!-- –ü–æ—Ä—Ç -->
                    {% if service.ports %}
                    <div class="tile-port">
                        {{ service.ports[0] }}
                    </div>
                    {% endif %}
    
                    <!-- IP-–∞–¥—Ä–µ—Å –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ -->
                    {% if service.ip_address and service.status != 'running' %}
                    <div class="tile-port">
                        {{ service.ip_address }}
                    </div>
                    {% endif %}
    
                    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
                    <div class="tile-header">
                        <span class="tile-icon">{{ service.icon }}</span>
                        <span class="tile-title" title="{{ service.name }}">
                            {{ service.name|truncate(20) }}
                        </span>
                    </div>
    
                    <!-- URL -->
                    <div class="tile-content">
                        {% if service.url %}
                        <div class="tile-url" title="{{ service.url }}">
                            {{ service.url|truncate(30) }}
                        </div>
                        {% endif %}
                    </div>
    
                    <!-- –°—Å—ã–ª–∫–∞ -->
                    {% if service.url and service.status == 'running' %}
                    <a href="{{ service.url }}" target="_blank" class="tile-link"></a>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <div class="tile empty-tile full-width-tile">
                    <div class="empty-content">
                        {% if error %}
                        <div class="text-danger">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤: {{ error }}</div>
                        {% else %}
                        <div>üì≠ –ù–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤</div>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        </div>

        <!-- –ò–ó–ë–†–ê–ù–ù–û–ï -->
        {% if favorites %}
        <div class="grid grid-auto mt-xxl">
            {% for favorite in favorites %}
            <div class="tile">
                <div class="tile-header">
                    <div class="favorite-icon">
                        {% if favorite.is_url_icon %}
                            <img src="{{ favorite.icon|string|trim }}" alt="Favicon" class="favicon-img">
                        {% else %}
                            <span class="default-favicon">{{ favorite.icon|string|trim if favorite.icon else 'üåê' }}</span>
                        {% endif %}
                    </div>
                    <span class="tile-title" title="{{ favorite.name }}">
                        {{ favorite.name|truncate(20) if favorite.name else favorite.url|truncate(20) }}
                    </span>
                </div>
                <div class="tile-content">
                    <div class="tile-url" title="{{ favorite.url }}">
                        {{ favorite.url|truncate(30) }}
                    </div>
                </div>
                <a href="{{ favorite.url }}" target="_blank" class="tile-link"></a>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
    </div>
    
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å –±–∞—Ä–∞
        function updateStatusBar() {
            fetch('/api/stats')
                .then(response => response.json())
                .then(data => {
                    if (data.system) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º CPU
                        document.getElementById('cpu-value').textContent = data.system.cpu_percent.toFixed(1) + '%';
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–º—è—Ç—å
                        const memory = data.system.memory;
                        const memoryPercent = memory.percent.toFixed(1) + '%';
                        const memoryUsedGB = (memory.used / (1024 ** 3)).toFixed(1);
                        const memoryTotalGB = (memory.total / (1024 ** 3)).toFixed(1);
                        document.getElementById('memory-value').textContent = memoryPercent;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
                        if (data.containers) {
                            document.getElementById('docker-total').textContent = data.containers.total;
                            document.getElementById('docker-running').textContent = data.containers.running;
                            document.getElementById('docker-stopped').textContent = data.containers.stopped;
                        }
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', error);
                });
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –±–∞—Ä –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        setInterval(updateStatusBar, 5000);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            updateStatusBar();
        });
    </script>
</body>
</html>
